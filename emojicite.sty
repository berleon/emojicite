
\usepackage{emoji}
\usepackage{natbib}

\usepackage{xparse}
\ExplSyntaxOn

\makeatletter
\NewDocumentCommand{\emojicite}{m}
 {
  \mjb_multicitep:n { #1 }
 }
\makeatother


\makeatletter
\NewDocumentCommand{\emojicitep}{m}
 {
  \NAT@open
  \mjb_multicitep:n { #1 }
  \NAT@close
 }
\makeatother

\seq_new:N \l_mjb_multicite_in_seq
\seq_new:N \l_mjb_multicite_out_seq
\seq_new:N \l_mjb_cite_seq

\cs_new_protected:Npn \mjb_multicitep:n #1
 {
  \seq_set_split:Nnn \l_mjb_multicite_in_seq { ; } { #1 }
  \seq_clear:N \l_mjb_multicite_out_seq
  \seq_map_inline:Nn \l_mjb_multicite_in_seq
   {
    \mjb_cite_process:n { ##1 }
   }
  \seq_use:Nn \l_mjb_multicite_out_seq { ;~ }
 }

\cs_new_protected:Npn \mjb_cite_process:n #1
{
    \seq_set_split:Nnn \l_mjb_cite_seq { , } { #1 }
    \int_compare:nTF { \seq_count:N \l_mjb_cite_seq == 1 }
    {
        \seq_put_right:Nn \l_mjb_multicite_out_seq
        { \citeauthor{#1},~\citeyear{#1} }
    }
    {
        \int_compare:nTF { \seq_count:N \l_mjb_cite_seq == 2 }
        {
            \seq_put_right:Nx \l_mjb_multicite_out_seq
             {
                 \exp_not:N \citeauthor{\seq_item:Nn \l_mjb_cite_seq { 1 }},~
                 \exp_not:N \citeyear{\seq_item:Nn \l_mjb_cite_seq { 1 }}~
                 \emoji{\seq_item:Nn \l_mjb_cite_seq { 2 }}
             }
        }
        % we can handle up to 2 emojis
        {
            \int_compare:nTF { \seq_count:N \l_mjb_cite_seq == 3 }
            {
                \seq_put_right:Nx \l_mjb_multicite_out_seq
                 {
                     \exp_not:N \citeauthor{\seq_item:Nn \l_mjb_cite_seq { 1 }},~
                     \exp_not:N \citeyear{\seq_item:Nn \l_mjb_cite_seq { 1 }}~
                     \emoji{\seq_item:Nn \l_mjb_cite_seq { 2 }}
                     \emoji{\seq_item:Nn \l_mjb_cite_seq { 3 }}
                 }
            }
            {
                \seq_put_right:Nx \l_mjb_multicite_out_seq
                 {
                     \exp_not:N \citeauthor{\seq_item:Nn \l_mjb_cite_seq { 1 }},~
                     \exp_not:N \citeyear{\seq_item:Nn \l_mjb_cite_seq { 1 }}~
                     \exp_not:N \textbf{emojicite~does~not~support~more~than~two~emojis}.
                 }
            }
        }
    }
 }
\ExplSyntaxOff

